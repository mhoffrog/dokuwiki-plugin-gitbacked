<?xml version="1.0"?>
<ruleset name="DokuWiki Coding Standard Standard" namespace="DokuWiki\CS\Standard">
    <description>Coding Standard used for DokuWiki</description>

    <!-- default config -->
    <arg name="colors"/>
    <arg value="sp"/>
    <arg name="extensions" value="php"/>

    <ini name="memory_limit" value="-1"/>

    <!-- where to look -->
    <file>../</file>

    <!-- skip these completely -->
    <exclude-pattern>*/_test/*</exclude-pattern>
    <exclude-pattern>*/vendor/*</exclude-pattern>

    <!-- rules on top of PSR-12 -->
    <rule ref="PSR12">
        <!-- This rule breaks the single line guard pattern that we prefer to keep using -->
        <exclude name="Generic.ControlStructures.InlineControlStructure.NotAllowed"/>

        <!-- comply with IntelliPhense k&r style: -->
        <exclude name="PSR2.Classes.ClassDeclaration.OpenBraceNewLine"/>
        <exclude name="Squiz.Functions.MultiLineFunctionDeclaration.BraceOnSameLine"/>
    </rule>

    <!-- allow long lines for localization files -->
    <rule ref="Generic.Files.LineLength.TooLong">
        <exclude-pattern>*/lang/*/lang.php</exclude-pattern>
        <exclude-pattern>*/lang/*/settings.php</exclude-pattern>
    </rule>
    
    <!-- disable some rules for certain paths, for legacy support -->
    <rule ref="Squiz.Classes.ValidClassName.NotCamelCaps">
        <!-- examples from original DW repo:
        <exclude-pattern>*/inc/Plugin.php</exclude-pattern>
        <exclude-pattern>*/inc/PluginInterface.php</exclude-pattern>
        <exclude-pattern>*/inc/PluginTrait.php</exclude-pattern>
        -->
    </rule>

    <!-- underscore skips exposing public methods to remote api -->
    <rule ref="PSR2.Methods.MethodDeclaration.Underscore">
        <!-- for now we allow underscore named functions  - should be improved at later stage -->
        <exclude-pattern>*/*.php</exclude-pattern>
    </rule>

    <rule ref="PSR2.Classes.PropertyDeclaration.Underscore">
        <!-- example from original DW repo:
        <exclude-pattern>*/inc/parser/*</exclude-pattern>
        -->
    </rule>

    <rule ref="PSR1.Methods.CamelCapsMethodName.NotCamelCaps">
        <!-- for now we allow NotCamelCaps named functions  - should be improved at later stage -->
        <exclude-pattern>*/*.php</exclude-pattern>
    </rule>
</ruleset>
